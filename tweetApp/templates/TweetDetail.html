{% extends "base.html" %}
{% load static %}


{% block site-icerik %}


<div class="mb-3 back-container">

    <a href="{% url 'index-view' %}">
        <ion-icon class="backBtn" name="arrow-back-outline"></ion-icon>
    </a>

    <span>Geri Dön</span>
</div>

<div class="card mb-4">

    <div class="card-body tweet-body">


        <div class="d-flex align-items-center avatar-container">


          <div>
              <img src="{{tweet.data.author.avatar.url}}" alt="Avatar">
          </div>

          <a class="username" href="{% url 'user-view' tweet.data.author.id %}">{{tweet.data.author.username}}</a>





        {% if request.user.is_authenticated and request.user.is_superuser or request.user.id == tweet.author.id %}
        
            <div class="dropdown ms-auto">
              <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false"></button>
              
              <ul class="dropdown-menu">
                <li> <button class="dropdown-item text-primary" data-bs-toggle="modal" data-bs-target="#tweet.data-{{tweet.data.id}}">Güncelle</button>  </li>
                <li> <a class="dropdown-item text-danger" href="{% url 'delete-tweet-view' tweet.data.id %}">Sil</a> </li>
              
              </ul>
            </div>
        {% endif %}

      </div>

         <div class="data-wrap" onclick="navigateToDetail(event, '{{tweet.data.id}}')">
            <p class="card-text tweet-text">{{tweet.data.tweet}}</p>


            {% if tweet.data.attachment %}

            <div class="tweet-attachment">

                <a href="{{tweet.data.attachment.url}}" target="_blank">
                  <img src="{{tweet.data.attachment.url}}" alt="tweet-attachment">
                </a>
                
            </div>
              
            {% endif %}

        </div>

      <div class="mt-3 d-flex tweet-footer">
        <!-- <ion-icon name="heart-sharp"></ion-icon> -->

        {% if request.user.is_authenticated %}
          
       
        <div class="tweet-footer-container">
        
          <div class="like-container">

          <ion-icon onclick="make_api_request(event, '{{tweet.data.id}}')" 
          class="heart" 
          
          {% if tweet.isLiked is True %}

              name = "heart-sharp"
          {% else %}

              name = "heart-outline"
          {% endif %}
          
          ></ion-icon>

          
          <span>{{tweet.data.show_likes}}</span>
          </div>


          <div class="comment-container">
              <ion-icon name="arrow-redo-outline"></ion-icon>
              <span>3</span>
          </div>
    

   
        </div>
        {% endif %}
        
        <small class="ms-auto text-muted">• {{tweet.data.createdAt}}</small>
      </div>

      <!-- comment alanı -->

      <form action="{% url 'tweet-comment-view' tweet.data.id %}" method="post">

        {% csrf_token %}

        <div class="d-flex align-items-center comment-wrapper">

           <div class="comment-field">

              <textarea name="comment-input" class="form-control" placeholder="Yanıt ver"></textarea>
          </div>


          <div>

            {% if request.user.is_authenticated %}
              
            <button class="btn" type="submit">
                <ion-icon name="send-sharp"></ion-icon>
            </button>

            {% else %}

            <a class="btn" href="{% url 'login-view' %}">

                <ion-icon name="send-sharp"></ion-icon>
            </a>

            {% endif %}
          
          
          </div>

        </div>



      </form>

    </div>

</div>




<div class="tweet-comment-wrapper">

    <h4 class="mb-2 ms-2">Yorumlar ({{tweet.data.comments.count}})</h4>

    {% for comment in tweet.data.comments.all %}
      
    <div class="card mb-3">

 
    <div class="d-flex align-items-center avatar-container">


        <div>
            <img src="{{comment.author.avatar.url}}" alt="Avatar">
        </div>

        <a class="username" href="{% url 'user-view' comment.author.id %}">{{comment.author.username}}</a>





      {% if request.user.is_authenticated and request.user.is_superuser or request.user.id == comment.author.id %}
      
          <div class="dropdown ms-auto">
            <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false"></button>
            
            <ul class="dropdown-menu">
              <li> <button class="dropdown-item text-primary" data-bs-toggle="modal" data-bs-target="#">Yorumu Güncelle</button>  </li>
              <li> <a class="dropdown-item text-danger" href="#">Yorumu Sil</a> </li>
            
            </ul>
          </div>
      {% endif %}


    </div>


    <div class="tweet-comment">

        <p>{{comment.message}}</p>
    </div>


    <div class="tweet-comment-footer">

        <p class="text-muted text-end pe-4"> <small>• {{comment.createdAt}}</small> </p>

    </div>
    
    </div>
    {% endfor %}

</div>

<script src="{% static 'Scripts/api_request.js' %}"></script>

{% endblock site-icerik %}